# Generated by python/repositories.bzl

load("@bazel_tools//tools/python:toolchain.bzl", "py_runtime_pair")

package(default_visibility = ["//visibility:public"])

filegroup(
    name = "files",
    srcs = glob(
        include = ["bin/**", "extensions/**", "include/**", "lib/**", "libs/**", "share/**"],
        # Platform-agnostic filegroup can't match on all patterns.
        allow_empty = True,
        exclude = ["**/* *", "lib/libpython{python_version}.so", "lib/**/*.a", "lib/python{python_version}/**/test/**", "lib/python{python_version}/**/tests/**", "**/__pycache__/*.pyc", "**/__pycache__/*.pyo"],
    ),
)

cc_import(
    name = "interface",
    interface_library = "libs/python310.lib",
    system_provided = True,
)

filegroup(
    name = "includes",
    srcs = glob(["include/**/*.h"]),
)

cc_library(
    name = "python_headers",
    deps = select({
        "@bazel_tools//src/conditions:windows": [":interface"],
        "//conditions:default": None,
    }),
    hdrs = [":includes"],
    includes = [
        "include",
        "include/python3.10",
        "include/python3.10m",
    ],
)

cc_library(
    name = "libpython",
    hdrs = [":includes"],
    srcs = select({
        "@platforms//os:windows": ["python3.dll", "libs/python310.lib"],
        "@platforms//os:macos": ["lib/libpython3.10.dylib"],
        "@platforms//os:linux": ["lib/libpython3.10.so", "lib/libpython3.10.so.1.0"],
    }),
)

exports_files(["python", "bin/python3"])

# Used to only download coverage toolchain when the coverage is collected by
# bazel.
config_setting(
    name = "coverage_enabled",
    values = {"collect_code_coverage": "true"},
    visibility = ["//visibility:private"],
)

py_runtime(
    name = "py3_runtime",
    files = [":files"],
    coverage_tool = select({
        ":coverage_enabled": None,
        "//conditions:default": None,
    }),
    interpreter = "bin/python3",
    python_version = "PY3",
)

py_runtime_pair(
    name = "python_runtimes",
    py2_runtime = None,
    py3_runtime = ":py3_runtime",
)
